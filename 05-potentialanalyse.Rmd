# Potentialanalyse

```{r potentialanalyse setup,  echo=FALSE, message=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)

suppressPackageStartupMessages(library(tidyverse)) # Tidying data
suppressPackageStartupMessages(library(sf)) # Reading Shapefiles
suppressPackageStartupMessages(library(here)) # Find correct place to load 
suppressPackageStartupMessages(library(tmap)) # Find correct place to load 

df <- readRDS(here("data/df_grune_pankow.rds"))

tmap_mode("view")

```

## "Wobble"-Bezirke (Variationskoeffizient)
```{r potentialanalyse1}
# Variationskoeffizient
library(DT)
datatable(
df %>% 
  st_drop_geometry() %>% 
  select(wahlbezirk, stimmanteil, wahl) %>% 
  group_by(wahlbezirk) %>% 
  summarise(Variationskoeffizient = round(100 * sd(stimmanteil) / mean(stimmanteil),2)) %>% 
  left_join(df %>% st_drop_geometry() %>% group_by(wahlbezirk, wahl) %>% summarise(stimmanteil)) %>% 
  pivot_wider(names_from = wahl, values_from = stimmanteil)
)
```
"Wobble" Bezirke sind Bezirke, deren Wahlergebnisse sich zwischen den Jahren sehr stark voneinander unterscheiden. 

## Differenez der Erst- und Zweitstimmen bei der Bundestagswahl 2009
```{r potentialanalyse2}
wahlen_zu_vergleichen = c("BUErststimme_2009", "BUZweitstimme_2009")

df %>% 
  filter(wahl %in% wahlen_zu_vergleichen) %>% 
  st_drop_geometry() %>% 
  select(wahlbezirk, stimmanteil, wahl) %>% 
  pivot_wider(names_from = wahl, values_from = stimmanteil) %>% 
  mutate("Differenz 1. - 2.Stimme" = get(wahlen_zu_vergleichen[1]) - get(wahlen_zu_vergleichen[2])) %>% 
  select(wahlbezirk, "Differenz 1. - 2.Stimme") %>% 
  left_join(df %>% filter(wahl == wahlen_zu_vergleichen[1]) %>% select(wahlbezirk)) %>% 
  st_as_sf() %>% 
  tm_shape() +
  tm_fill("Differenz 1. - 2.Stimme") +
  tm_borders() +
    tm_layout(frame = FALSE) 
```


## Differenez der Erst- und Zweitstimmen bei den Wahlen zum Abgeordnetenhaus 2011
```{r potentialanalyse3}
wahlen_zu_vergleichen = c("AGHErststimme_2011", "AGHZweitstimme_2011")

df %>% 
  filter(wahl %in% wahlen_zu_vergleichen) %>% 
  st_drop_geometry() %>% 
  select(wahlbezirk, stimmanteil, wahl) %>% 
  pivot_wider(names_from = wahl, values_from = stimmanteil) %>% 
  mutate("Differenz 1. - 2.Stimme" = get(wahlen_zu_vergleichen[1]) - get(wahlen_zu_vergleichen[2])) %>% 
  select(wahlbezirk, "Differenz 1. - 2.Stimme") %>% 
  left_join(df %>% filter(wahl == wahlen_zu_vergleichen[1]) %>% select(wahlbezirk)) %>% 
  st_as_sf() %>% 
  tm_shape() +
  tm_fill("Differenz 1. - 2.Stimme") +
  tm_borders() +
    tm_layout(frame = FALSE) 
```


## Differenez der Erst- und Zweitstimmen bei der Bundestagswahl 2013
```{r potentialanalyse4}
wahlen_zu_vergleichen = c("BUErststimme_2013", "BUZweitstimme_2013")

df %>% 
  filter(wahl %in% wahlen_zu_vergleichen) %>% 
  st_drop_geometry() %>% 
  select(wahlbezirk, stimmanteil, wahl) %>% 
  pivot_wider(names_from = wahl, values_from = stimmanteil) %>% 
  mutate("Differenz 1. - 2.Stimme" = get(wahlen_zu_vergleichen[1]) - get(wahlen_zu_vergleichen[2])) %>% 
  select(wahlbezirk, "Differenz 1. - 2.Stimme") %>% 
  left_join(df %>% filter(wahl == wahlen_zu_vergleichen[1]) %>% select(wahlbezirk)) %>% 
  st_as_sf() %>% 
  tm_shape() +
  tm_fill("Differenz 1. - 2.Stimme") +
  tm_borders() +
    tm_layout(frame = FALSE) 
```

## Differenez der Erst- und Zweitstimmen bei den Wahlen zum Abgeordnetenhaus 2016
```{r potentialanalyse5}
wahlen_zu_vergleichen = c("AGHErststimme_2016", "AGHZweitstimme_2016")

df %>% 
  filter(wahl %in% wahlen_zu_vergleichen) %>% 
  st_drop_geometry() %>% 
  select(wahlbezirk, stimmanteil, wahl) %>% 
  pivot_wider(names_from = wahl, values_from = stimmanteil) %>% 
  mutate("Differenz 1. - 2.Stimme" = get(wahlen_zu_vergleichen[1]) - get(wahlen_zu_vergleichen[2])) %>% 
  select(wahlbezirk, "Differenz 1. - 2.Stimme") %>% 
  left_join(df %>% filter(wahl == wahlen_zu_vergleichen[1]) %>% select(wahlbezirk)) %>% 
  st_as_sf() %>% 
  tm_shape() +
  tm_fill("Differenz 1. - 2.Stimme") +
  tm_borders() +
  tm_layout(frame = FALSE) +
  tm_layout(legend.title.size = 4,
          legend.text.size = 2,
          legend.position = c("left","bottom"),
          legend.bg.color = "white",
          legend.bg.alpha = 1,
          legend.outside = TRUE)
```



## Differenez der Erst- und Zweitstimmen bei der Bundestagswahl 2017
```{r potentialanalyse6}
wahlen_zu_vergleichen = c("BU1_2017", "BU2_2017")

df %>% 
  filter(wahl %in% wahlen_zu_vergleichen) %>% 
  st_drop_geometry() %>% 
  select(wahlbezirk, stimmanteil, wahl) %>% 
  pivot_wider(names_from = wahl, values_from = stimmanteil) %>% 
  mutate("Differenz" = get(wahlen_zu_vergleichen[1]) - get(wahlen_zu_vergleichen[2])) %>% 
  select(wahlbezirk, "Differenz") %>% 
  left_join(df %>% filter(wahl == wahlen_zu_vergleichen[1]) %>% select(wahlbezirk)) %>% 
  st_as_sf() %>% 
  tm_shape() +
  tm_fill("Differenz") +
  tm_borders() +
    tm_layout(frame = FALSE) +
    tm_layout(legend.title.size = 2,
          legend.text.size = 1,
          legend.position = c("left","bottom"),
          legend.bg.color = "white",
          legend.bg.alpha = 1,
          legend.outside = TRUE)
```
